<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Sinh vi√™n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">

    <h2 class="text-center mb-4">üéì H·ªÜ TH·ªêNG QU·∫¢N L√ù SINH VI√äN</h2>

    <!-- üîç SEARCH -->
    <div class="card mb-3 shadow-sm">
        <div class="card-body">
            <input id="searchBox" class="form-control"
                   placeholder="T√¨m ID, t√™n, ƒë·ªãa ch·ªâ, ng√†y sinh (yyyy-mm-dd) ho·∫∑c tu·ªïi"
                   onkeyup="smartSearch()">
        </div>
    </div>

    <!-- ‚ûï FORM -->
    <div class="card mb-3 shadow-sm">
        <div class="card-body">
            <form id="studentForm">
                <input type="hidden" id="studentId">

                <div class="row g-2">
                    <div class="col-md-3">
                        <input type="text" id="name" class="form-control" placeholder="T√™n" required>
                    </div>
                    <div class="col-md-3">
                        <input type="email" id="email" class="form-control" placeholder="Email">
                    </div>
                    <div class="col-md-2">
                        <input type="date" id="birthDate" class="form-control">
                    </div>
                    <div class="col-md-2">
                        <input type="text" id="address" class="form-control" placeholder="ƒê·ªãa ch·ªâ">
                    </div>
                    <div class="col-md-2">
                        <input type="text" id="studentClass" class="form-control" placeholder="L·ªõp">
                    </div>
                </div>

                <button class="btn btn-primary mt-3 w-100">L∆∞u sinh vi√™n</button>
            </form>
        </div>
    </div>

    <!-- üìã TABLE -->
    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-bordered table-hover text-center align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>T√™n</th>
                        <th>Email</th>
                        <th>Ng√†y sinh</th>
                        <th>Tu·ªïi</th>
                        <th>ƒê·ªãa ch·ªâ</th>
                        <th>L·ªõp</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="studentTable"></tbody>
            </table>
        </div>
    </div>

</div>

<script>
const API = "http://localhost:8080/api/students";
const table = document.getElementById("studentTable");
const form = document.getElementById("studentForm");
const searchBox = document.getElementById("searchBox");

document.addEventListener("DOMContentLoaded", loadStudents);

// LOAD ALL
function loadStudents(){
    fetch(API)
        .then(res => res.json())
        .then(renderTable);
}

// SEARCH
function smartSearch(){
    const key = searchBox.value.trim();
    if(key === "") return loadStudents();

    fetch(API + "/search?keyword=" + key)
        .then(res => res.json())
        .then(renderTable);
}

// RENDER TABLE
function renderTable(data){
    table.innerHTML = "";
    data.forEach(s => {
        const age = s.birthDate ? new Date().getFullYear() - new Date(s.birthDate).getFullYear() : "";
        table.innerHTML += `
            <tr>
                <td>${s.id}</td>
                <td>${s.name}</td>
                <td>${s.email || ""}</td>
                <td>${s.birthDate || ""}</td>
                <td>${age}</td>
                <td>${s.address || ""}</td>
                <td>${s.studentClass || ""}</td>
                <td>
                    <button class="btn btn-success btn-sm" onclick="showAddForm()">Th√™m</button>
                    <button class="btn btn-warning btn-sm" onclick='editStudent(${JSON.stringify(s)})'>S·ª≠a</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteStudent(${s.id})">X√≥a</button>
                </td>
            </tr>`;
    });
}

// SHOW FORM ADD
function showAddForm(){
    form.reset();
    studentId.value = "";
    name.focus();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// SAVE / UPDATE
form.addEventListener("submit", e => {
    e.preventDefault();

    const id = studentId.value;

    const student = {
        name: name.value,
        email: email.value,
        birthDate: birthDate.value,
        address: address.value,
        studentClass: studentClass.value
    };

    const method = id ? "PUT" : "POST";
    const url = id ? API + "/" + id : API;

    fetch(url, {
        method,
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(student)
    }).then(() => {
        form.reset();
        loadStudents();
    });
});

// EDIT
function editStudent(s){
    studentId.value = s.id;
    name.value = s.name;
    email.value = s.email;
    birthDate.value = s.birthDate;
    address.value = s.address;
    studentClass.value = s.studentClass;
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// DELETE
function deleteStudent(id){
    if(confirm("X√≥a sinh vi√™n n√†y?")){
        fetch(API + "/" + id, {method:"DELETE"})
            .then(loadStudents);
    }
}
</script>

</body>
</html>
