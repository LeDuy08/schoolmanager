<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Quản lý sinh viên</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h3>QUẢN LÝ SINH VIÊN</h3>
<div id="msg"></div>

<!-- FORM THÊM / SỬA -->
<div class="card mb-4">
    <div class="card-body">
        <h4 id="formTitle">Thêm sinh viên</h4>

        <input type="hidden" id="studentId">

        <input id="name" class="form-control mb-2" placeholder="Tên">
        <input id="birthDate" type="date" class="form-control mb-2">
        <input id="address" class="form-control mb-2" placeholder="Địa chỉ">
        <input id="studentClass" class="form-control mb-2" placeholder="Lớp">
        <input id="email" class="form-control mb-2" placeholder="Email">

        <button class="btn btn-primary" onclick="saveStudent()">Lưu</button>
        <button class="btn btn-secondary" onclick="cancelEdit()">Huỷ</button>
    </div>
</div>

<!-- BẢNG DANH SÁCH -->
<table class="table table-bordered">
    <thead>
    <tr>
        <th>ID</th>
        <th>Tên</th>
        <th>Ngày sinh</th>
        <th>Địa chỉ</th>
        <th>Lớp</th>
        <th>Email</th>
        <th>Hành động</th>
    </tr>
    </thead>
    <tbody id="studentTable"></tbody>
</table>

<script>
const API = "http://localhost:8080/api/students";

function showMsg(text, type="success"){
    document.getElementById("msg").innerHTML =
        `<div class="alert alert-${type}">${text}</div>`;
    setTimeout(()=>document.getElementById("msg").innerHTML="",2000);
}

function loadStudents() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name || ""}</td>
                    <td>${s.birthDate || ""}</td>
                    <td>${s.address || ""}</td>
                    <td>${s.studentClass || ""}</td>
                    <td>${s.email || ""}</td>
                    <td>
                        <button class="btn btn-warning btn-sm"
                          onclick='editStudent(${JSON.stringify(s)})'>Sửa</button>
                        <button class="btn btn-danger btn-sm"
                          onclick="deleteStudent(${s.id})">Xóa</button>
                    </td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

function saveStudent() {
    const id = document.getElementById("studentId").value;

    const student = {
        name: document.getElementById("name").value.trim(),
        birthDate: document.getElementById("birthDate").value,
        address: document.getElementById("address").value.trim(),
        studentClass: document.getElementById("studentClass").value.trim(),
        email: document.getElementById("email").value.trim()
    };

    if(!student.name || !student.email){
        showMsg("Tên và Email là bắt buộc!", "warning");
        return;
    }

    if(id){
        fetch(`${API}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        }).then(()=>{
            showMsg("Cập nhật thành công!");
            cancelEdit();
            loadStudents();
        });
    } else {
        fetch(API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        }).then(()=>{
            showMsg("Thêm thành công!");
            cancelEdit();
            loadStudents();
        });
    }
}

function editStudent(s){
    document.getElementById("studentId").value = s.id;
    document.getElementById("name").value = s.name || "";
    document.getElementById("birthDate").value = s.birthDate || "";
    document.getElementById("address").value = s.address || "";
    document.getElementById("studentClass").value = s.studentClass || "";
    document.getElementById("email").value = s.email || "";
    document.getElementById("formTitle").innerText = "Cập nhật sinh viên";
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function cancelEdit(){
    document.getElementById("studentId").value = "";
    document.getElementById("name").value = "";
    document.getElementById("birthDate").value = "";
    document.getElementById("address").value = "";
    document.getElementById("studentClass").value = "";
    document.getElementById("email").value = "";
    document.getElementById("formTitle").innerText = "Thêm sinh viên";
}

function deleteStudent(id) {
    if(!confirm("Bạn chắc chắn muốn xoá?")) return;
    fetch(`${API}/${id}`, { method: "DELETE" })
        .then(()=>{
            showMsg("Xoá thành công!");
            loadStudents();
        });
}

loadStudents();
</script>
</body>
</html>
